(function(){var b=function(c){this.init(c);return this};b.prototype={init:function(c){this.update(c);this.element.load(function(){$(this).trigger("ready.parallax")})},update:function(c){var d=$.extend(true,{xAxis:true,yAxis:true,xSpeed:0.2,scale:0,ySpeed:0.2,xRange:[0,1],yRange:[0,1]},c);$.extend(true,this,d);if(!this.element){this.element=$("<img />")}this.element.attr("src",this.src);if(this.scale){this.element.height((this.scale*100)+"%")}else{this.element.css("height","")}this.element.css({position:"absolute",left:(this.xRange[0]*100)+"%",top:(this.yRange[0]*100)+"%",marginLeft:"",marginTop:""})},render:function(c){c.append(this.element);return this},move:function(h){var i={},l,f,d,j,k,e,c,g;if(this.xAxis){l=h.x*this.xSpeed;f=this.xRange[0]+l;d=Math.max.apply(null,this.xRange);j=Math.min.apply(null,this.xRange);xDiff=(this.element.width()-this.viewport.width())/this.viewport.width();if(xDiff>0){j=Math.max(j,-xDiff);d=Math.min(d,xDiff)}if(f>=j&&f<=d){i.marginLeft=(l*100)+"%"}}if(this.yAxis){k=h.y*this.ySpeed;e=this.yRange[0]+k;c=Math.max.apply(null,this.yRange);g=Math.min.apply(null,this.yRange);yDiff=(this.element.height()-this.viewport.height())/this.viewport.height();if(yDiff>0){g=Math.max(g,-yDiff);c=Math.min(c,yDiff)}if(e>=g&&e<=c){i.marginTop=(k*100)+"%"}}this.element.css(i)},destroy:function(){this.element.remove();this.viewport=null}};var a=function(d,c){this.init(d,c);return this};a.prototype={init:function(d,c){this.options=$.extend({},c);this.element=d;this.layers=[];this.layersReady=0;this.initLayers()},_onLayerReady:function(){var c=this;this.layersReady++;if(this.layersReady===this.layers.length){this.element.on("mousemove.parallax",function(d){var f=$(this).offset(),e={x:d.pageX-f.left,y:d.pageY-f.top};c.animate(e)});this.options.ready&&this.options.ready()}},width:function(){return this.element.width()},height:function(){return this.element.height()},initLayers:function(){var c=this.options.layers.length,e,d,f=this;for(d=0;d<c;d++){this.options.layers[d].viewport=this;e=new b(this.options.layers[d]);e.element.bind("ready.parallax",function(){$(this).unbind("ready.parallax");f._onLayerReady()});this.layers.push(e);if(e.name){this[e.name]=e}e.render(this.element)}},animate:function(c){var f,e,d,g=this.layers.length;d={x:(c.x/this.width()),y:(c.y/this.height())};for(f=0;f<g;f++){e=this.layers[f];e.move(d)}return this},destroy:function(){var c=this.layers.length,d;this.element.unbind("mousemove.parallax");for(d=0;d<c;d++){this.layers[d].destroy()}}};$.fn.parallax=function(d,e,c){if(d==="settings"){return this[0].parallax[e]&&this[0].parallax[e]}return $(this).each(function(){if(d==="destroy"){this.parallax.destroy()}else{if(d==="update"){this.parallax[e]&&this.parallax[e].update(c)}else{this.parallax=new a($(this),d)}}})}})();