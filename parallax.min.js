(function(){var b=function(c){this.init(c);return this};b.prototype={init:function(c){this.update(c);this.element.load(function(){$(this).trigger("ready.parallax")})},update:function(c){var d=$.extend(true,{xAxis:true,yAxis:true,xSpeed:0.2,scale:0,ySpeed:0.2,xRange:[0,1],yRange:[0,1]},c);$.extend(true,this,d);if(!this.element){this.element=$("<img />")}this.element.attr("src",this.src);if(this.scale){this.element.height((this.scale*100)+"%")}this.element.css({position:"absolute",left:(this.xRange[0]*100)+"%",top:(this.yRange[0]*100)+"%"})},render:function(c){c.append(this.element);return this},move:function(c){var f={},e,j,h,d,g=Math.abs(this.element.width()-this.viewport.width()),i=Math.abs(this.element.height()-this.viewport.height());if(this.xAxis){f.marginLeft=(c.x*100*this.xSpeed);e=g*100/this.viewport.width();h=((this.xRange[1]-this.xRange[0])*100);if(Math.abs(f.marginLeft)<=e&&h>=f.marginLeft){f.marginLeft+="%"}else{delete f.marginLeft}}if(this.yAxis){f.marginTop=(c.y*100*this.ySpeed);j=i*100/this.viewport.height();d=((this.yRange[1]-this.yRange[0])*100);if(Math.abs(f.marginTop)<=j){f.marginTop+="%"}else{delete f.marginTop}}this.element.css(f)},destroy:function(){this.element.remove();this.viewport=null}};var a=function(d,c){this.init(d,c);return this};a.prototype={init:function(d,c){this.options=$.extend({},c);this.element=d;this.layers=[];this.layersReady=0;this.initLayers()},_onLayerReady:function(){var c=this;this.layersReady++;if(this.layersReady===this.layers.length){this.element.on("mousemove.parallax",function(d){var f=$(this).offset(),e={x:d.pageX-f.left,y:d.pageY-f.top};c.animate(e)});this.options.ready&&this.options.ready()}},width:function(){return this.element.width()},height:function(){return this.element.height()},initLayers:function(){var c=this.options.layers.length,e,d,f=this;for(d=0;d<c;d++){this.options.layers[d].viewport=this;e=new b(this.options.layers[d]);e.element.bind("ready.parallax",function(){$(this).unbind("ready.parallax");f._onLayerReady()});this.layers.push(e);this[e.name]=e;e.render(this.element)}},animate:function(c){var f,e,d,g=this.layers.length;d={x:(c.x/this.width()),y:(c.y/this.height())};for(f=0;f<g;f++){e=this.layers[f];e.move(d)}return this},destroy:function(){var c=this.layers.length,d;this.element.unbind("mousemove.parallax");for(d=0;d<c;d++){this.layers[d].destroy()}}};$.fn.parallax=function(d,e,c){return $(this).each(function(){if(d==="destroy"){this.parallax.destroy()}else{if(d==="update"){this.parallax[e].update(c)}else{this.parallax=new a($(this),d)}}})}})();